@startuml
left to right direction
skinparam rectangle {
  BorderColor #406E8E
  BackgroundColor #EEF5FF
}
skinparam database {
  BackgroundColor #E9F7EF
  BorderColor #2E7D32
}
skinparam cloud {
  BackgroundColor #FFF3E0
  BorderColor #EF6C00
}
skinparam actorStyle awesome

actor "Пациент" as Patient

rectangle "Ресепшен\n(запись, договоры)\n(маскирование на экране, обфускация в логах)" as Reception
rectangle "Врач / Мед.специалист\n(приём, назначения)\n(маскирование лишних полей, обфускация в логах)" as Doctor
rectangle "Кассир\n(приём оплаты)\n(маскирование платёжных реквизитов, обфускация в логах)" as Cashier
rectangle "Бухгалтерия\n(процессинг платежей)\n(маскирование в отчётах, обфускация идентификаторов)" as Accounting
rectangle "Склад\n(учёт ТМЦ)\n(маскирование персональных полей в печатных формах)" as Warehouse

cloud "Лаборатория\n(внешняя система)\n(шифрование канала/VPN, обфускация ID пациента у партнёра)" as Lab

database "Журнал записей\n(Excel / общий диск)\n(шифрование на диске, маскирование в выгрузках)" as Journal
database "Реестр пациентов\n(Excel / общий диск)\n(шифрование на диске, маскирование в поиске/списках)" as Patients
database "Медкарты и сканы\n(PDF/JPG / общий диск)\n(шифрование на диске, обфускация имён файлов/метаданных)" as MedCards
database "Результаты анализов\n(PDF/JPG / общий диск)\n(шифрование на диске, маскирование в выборках)" as LabResults
database "Платёжный реестр\n(Excel / общий диск)\n(шифрование на диске, маскирование PAN/СНИЛС)" as PayExcel
database "1С: Бухгалтерия\n(файловый режим)\n(шифрование файловой БД/транспорта, маскирование в печатных формах)" as OneCAcc
database "1С: Торговля и склад\n(файловый режим)\n(шифрование файловой БД/транспорта)" as OneCInv
cloud "Почта (Exchange)\n(внутренний сервер)\n(шифрование TLS, шифрование вложений)" as Mail

Patient -down-> Reception : Персональные данные (PII),\nконтактные данные, согласия (маскирование при вводе, обфускация в логах, минимизация до функциональной достаточности)

Reception -down-> Journal : Запись на приём (шифрование на диске)
Reception -down-> Patients : Создание/обновление профиля пациента (шифрование на диске, маскирование в списках - еще лучше, сокрытие лишней информации, доступ по идентификатору)
Reception -down-> MedCards : Загрузка сканов договоров/паспортов (шифрование на диске,\nобфускация имён файлов)
Reception -down-> Mail : Уведомления/переписка (PII) (шифрование TLS,\nминимизация PII, дополнительная валидация через backend)

Reception -right-> Doctor : Расписание, карточка визита,\nосн. данные пациента (минимум PII)\n(маскирование лишних полей, обфускация/псевдонимизация patient_id)

Doctor -down-> MedCards : Записи о приёме, назначения,\nзаключения (мед.тайна) (шифрование на диске,\nмаскирование при частичном доступе,\nобфускация в выгрузках/логах)

Doctor -right-> Lab : Направление на анализы (PII + мед.данные)\n(шифрование канала TLS/VPN,\nобфускация/псевдонимизация patient_id)
Lab -left-> LabResults : Хранение результатов (внешне)\n(шифрование на стороне партнёра)
Lab -left-> Doctor : Результаты анализов (PDF/JPG, e-mail)\n(шифрование TLS/вложений,\nмаскирование в превью/уведомлениях)

Patient -down-> Cashier : Оплата услуг (маскирование PAN/телефона на экране,\nобфускация в логах\n подмена id платежей на токены)
Cashier -down-> PayExcel : Запись оплаты (Excel) (шифрование на диске,\nмаскирование PAN/ссылок на ПД)
Cashier -down-> OneCAcc : Документ оплаты (через 1С) (шифрование канала,\nмаскирование реквизитов в печатных формах)
Cashier -left-> Mail : Отправка чеков/квитанций (по запросу)\n(шифрование TLS, маскирование реквизитов в письме)

PayExcel -down-> Accounting : Реестр оплат (для сверки)\n(маскирование персональных полей в отчётах, минимизация)
Accounting -right-> OneCInv : Обмен справочниками/документами\n(шифрование канала)

Warehouse -right-> OneCInv : Приход/расход ТМЦ, заявки на закупку\n(шифрование канала, шифрование документации)

Lab -down-> Mail : Результаты/уведомления (письма с вложениями)\n(шифрование TLS, шифрование вложений,\nобфускация темы/идентификаторов)
Mail -down-> MedCards : Сохранение вложений в карту (вручную)\n(шифрование на диске, обфускация имён файлов)

Reception -up-> Patient : Подтверждение записи/памятки (почта/звонок)\n(маскирование PII в уведомлениях)
Cashier -up-> Patient : Чек/квитанция (маскирование PAN/ККМ-данных)
Doctor -up-> Patient : Рекомендации, результаты (иногда по почте)\n(шифрование канала при e-mail,\nмаскирование лишних данных)

@enduml
